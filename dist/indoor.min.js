/* @preserve
 * IndoorJS 1.0.18+master.3cb5fd5, a JS library for interactive indoor maps. https://mudin.github.io/indoorjs
 * (c) 2019 Mudin Ibrahim
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fabric-pure-browser"),require("eventemitter2")):"function"==typeof define&&define.amd?define(["exports","fabric-pure-browser","eventemitter2"],e):e((t=t||self).Indoor={},t.fabric$1,t.EventEmitter2)}(this,function(t,e,s){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s;var i="1.0.18+master.3cb5fd5";function Z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function a(o){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach(function(t){var e,i,n;e=o,n=s[i=t],i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(s,t))})}return o}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function o(t,e,i){return(o=d()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return i&&u(o,i.prototype),o}).apply(null,arguments)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?f(t):e}function p(n){var o=d();return function(){var t,e=l(n);if(o){var i=l(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return v(this,t)}}function g(t,e,i){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function N(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,s=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done)&&(i.push(r.value),!e||i.length!==e);n=!0);}catch(t){o=!0,s=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw s}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return m(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return m(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var y=function(t){h(a,fabric.Point);var r=p(a);function a(){var t,e;Z(this,a);for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];if(1<n.length)t=n[0],e=n[1];else if(0!==n.length&&n[0])if(Object.prototype.hasOwnProperty.call(n[0],"x"))t=n[0].x,e=n[0].y;else if(n[0].length){var s=N(n[0],2);t=s[0],e=s[1]}else console.error("Parameter for Point is not valid. Use Point(x,y) or Point({x,y}) or Point([x,y])",n);else e=t=0;return r.call(this,t,e)}return c(a,[{key:"setX",value:function(t){this.x=t||0}},{key:"setY",value:function(t){this.y=t||0}},{key:"copy",value:function(t){this.x=t.x,this.y=t.y}},{key:"getArray",value:function(){return[this.x,this.y]}}]),a}(),b={SELECT:"SELECT",GRAB:"GRAB",MEASURE:"MEASURE",DRAW:"DRAW"},w={center:new y,zoom:1,minZoom:0,maxZoom:20,gridEnabled:!0,zoomEnabled:!0,selectEnabled:!0,mode:b.SELECT,showGrid:!0},k={position:new y,minZoom:1,maxZoom:20},x={url:"data:image/png;base64,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",size:[128,128],anchor:[64,64]};fabric.Object.prototype.originX="center",fabric.Object.prototype.originY="center",fabric.Object.prototype.lockUniScaling=!0,fabric.Object.prototype.lockScalingFlip=!0,fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.centeredScaling=!0,fabric.Object.prototype.cornerColor="blue",fabric.Object.prototype.borderColor="blue",fabric.Object.prototype.borderOpacity=.7,fabric.Object.prototype.cornerOpacity=.7,fabric.Object.prototype.cornerStrokeColor="blue",fabric.Object.prototype.borderColor="#ff0099",fabric.Object.prototype.cornerColor="#00eaff",fabric.Object.prototype.cornerStrokeColor="#00bbff",fabric.Object.prototype.objectCaching=!1,fabric.Group.prototype.objectCaching=!0,fabric.Group.prototype.selectionBackgroundColor="rgba(45,207,171,0.25)",fabric.Object.prototype.borderDashArray=[3,3],fabric.Object.prototype.padding=5,fabric.Object.prototype.getBounds=function(){var t=[];return t.push(new y(this.left-this.width/2,this.top-this.height/2)),t.push(new y(this.left+this.width/2,this.top+this.height/2)),t};var A="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function O(){throw new Error("setTimeout has not been defined")}function C(){throw new Error("clearTimeout has not been defined")}var j=O,E=C;function M(e){if(j===setTimeout)return setTimeout(e,0);if((j===O||!j)&&setTimeout)return j=setTimeout,setTimeout(e,0);try{return j(e,0)}catch(t){try{return j.call(null,e,0)}catch(t){return j.call(this,e,0)}}}"function"==typeof A.setTimeout&&(j=setTimeout),"function"==typeof A.clearTimeout&&(E=clearTimeout);var L,P=[],R=!1,W=-1;function z(){R&&L&&(R=!1,L.length?P=L.concat(P):W=-1,P.length&&S())}function S(){if(!R){var t=M(z);R=!0;for(var e=P.length;e;){for(L=P,P=[];++W<e;)L&&L[W].run();W=-1,e=P.length}L=null,R=!1,function(e){if(E===clearTimeout)return clearTimeout(e);if((E===C||!E)&&clearTimeout)return E=clearTimeout,clearTimeout(e);try{E(e)}catch(t){try{return E.call(null,e)}catch(t){return E.call(this,e)}}}(t)}}function T(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];P.push(new I(t,e)),1!==P.length||R||M(S)}function I(t,e){this.fun=t,this.array=e}I.prototype.run=function(){this.fun.apply(null,this.array)};var F=A.performance||{},Y=(F.now||F.mozNow||F.msNow||F.oNow||F.webkitNow,function(t){return"number"==typeof t&&!isNaN(t)}),B=function(t,e){var i=(e=e||t.currentTarget).getBoundingClientRect(),n=t.originalEvent||t,o=0,s=0;t.touches&&t.touches.length?Y(t.touches[0].pageX)&&Y(t.touches[0].pageY)?(o=t.touches[0].pageX,s=t.touches[0].pageY):Y(t.touches[0].clientX)&&Y(t.touches[0].clientY)&&(o=n.touches[0].clientX,s=n.touches[0].clientY):Y(t.pageX)&&Y(t.pageY)?(o=t.pageX,s=t.pageY):t.currentPoint&&Y(t.currentPoint.x)&&Y(t.currentPoint.y)&&(o=t.currentPoint.x,s=t.currentPoint.y);var r=!1;return"which"in t?r=3==t.which:"button"in t&&(r=2==t.button),{x:o-i.left,y:s-i.top,isRight:r}};window.addEventListener("touchmove",function(){});var D=function t(e){var n,o,s,r,a,c,h,l,i,u,d,f=e.source,v=void 0===f?document:f,p=e.update,g=e.stop,m=e.multiplier,y=void 0===m?1:m,b=e.friction,w=void 0===b?.92:b,k=e.initialValues,x=e.boundX,A=e.boundY,O=e.bounce,C=void 0===O||O;Z(this,t);var j=0,E=0,M=.3*y,L=!1,P=!1,R=!1,W=!1,z=[];function S(){document.removeEventListener("touchmove",Y,!!K()&&{passive:!1}),document.removeEventListener("touchend",B),document.removeEventListener("touchcancel",D),document.removeEventListener("mousemove",Y,!!K()&&{passive:!1}),document.removeEventListener("mouseup",B)}function T(){p.call(v,j,E)}function I(t){if("touchmove"!==t.type&&"touchstart"!==t.type&&"touchend"!==t.type)return{x:t.clientX,y:t.clientY,id:null};var e=t.targetTouches[0]||t.changedTouches[0];return{x:e.clientX,y:e.clientY,id:e.identifier}}function F(t){var e=I(t);P||R||(W=!(P=!0),i=e.id,a=h=e.x,c=l=e.y,z=[],X(a,c),S(),document.addEventListener("touchmove",Y,!!K()&&{passive:!1}),document.addEventListener("touchend",B),document.addEventListener("touchcancel",D),document.addEventListener("mousemove",Y,!!K()&&{passive:!1}),document.addEventListener("mouseup",B))}function Y(t){t.preventDefault();var e=I(t);P&&e.id===i&&(h=e.x,l=e.y,X(a,c),function(){L||H(U);L=!0}())}function B(t){var e=I(t);P&&e.id===i&&D()}function D(){P=!1,X(a,c),function(){var t=z[0],e=z[z.length-1],i=e.x-t.x,n=e.y-t.y,o=(e.time-t.time)/15/y;u=i/o||0,d=n/o||0;var s=G();1<Math.abs(u)||1<Math.abs(d)||!s.inBounds?(W=!0,H(Q)):g&&g(v)}(),S()}function X(t,e){for(var i=Date.now();0<z.length&&!(i-z[0].time<=100);)z.shift();z.push({x:t,y:e,time:i})}function U(){var t=h-a,e=l-c;if(j+=t*y,E+=e*y,C){var i=G();0!==i.x&&(j-=t*q(i.x)*y),0!==i.y&&(E-=e*q(i.y)*y)}else G(!0);T(),a=h,c=l,L=!1}function q(t){return 5e-6*Math.pow(t,2)+1e-4*t+.55}function G(t){var e=0,i=0;return void 0!==n&&j<n?e=n-j:void 0!==o&&o<j&&(e=o-j),void 0!==s&&E<s?i=s-E:void 0!==r&&r<E&&(i=r-E),t&&(0!==e&&(j=0<e?n:o),0!==i&&(E=0<i?s:r)),{x:e,y:i,inBounds:0===e&&0===i}}function Q(){if(W){j+=u*=w,E+=d*=w;var t=G();if(Math.abs(u)>M||Math.abs(d)>M||!t.inBounds){if(C){if(0!==t.x)if(t.x*u<=0)u+=.04*t.x;else{var e=0<t.x?2.5:-2.5;u=.11*(t.x+e)}if(0!==t.y)if(t.y*d<=0)d+=.04*t.y;else{var i=0<t.y?2.5:-2.5;d=.11*(t.y+i)}}else 0!==t.x&&(j=0<t.x?n:o,u=0),0!==t.y&&(E=0<t.y?s:r,d=0);T(),H(Q)}else W=!1,g&&g(v)}}!function(){if(!(v="string"==typeof v?document.querySelector(v):v))throw new Error("IMPETUS: source not found.");if(!p)throw new Error("IMPETUS: update function not defined.");k&&(k[0]&&(j=k[0]),k[1]&&(E=k[1]),T()),x&&(n=x[0],o=x[1]),A&&(s=A[0],r=A[1]),v.addEventListener("touchstart",F),v.addEventListener("mousedown",F)}(),this.destroy=function(){return v.removeEventListener("touchstart",F),v.removeEventListener("mousedown",F),S(),null},this.pause=function(){S(),R=!(P=!1)},this.resume=function(){R=!1},this.setValues=function(t,e){"number"==typeof t&&(j=t),"number"==typeof e&&(E=e)},this.setMultiplier=function(t){M=.3*(y=t)},this.setBoundX=function(t){n=t[0],o=t[1]},this.setBoundY=function(t){s=t[0],r=t[1]}},H=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};function K(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return K=function(){return t},t}var X={left:0,top:0};function U(t,e,i){e=e||t.currentTarget||t.srcElement,Array.isArray(i)||(i=[0,0]);var n,o=t.clientX||0,s=t.clientY||0,r=(n=e)===window||n===document||n===document.body?X:n.getBoundingClientRect();return i[0]=o-r.left,i[1]=s-r.top,i}function q(h){h=h||window;var l=new s,u=[null,null],d=0,f=0,v=!1,t=!1;return Object.defineProperties(l,{pinching:function(){return 2===d},fingers:function(){return u}}),e(),l.enable=e,l.disable=function(){if(!t)return;t=!1,u[d=0]=null,u[1]=null,f=0,v=!1,h.removeEventListener("touchstart",i,!1),h.removeEventListener("touchmove",n,!1),h.removeEventListener("touchend",o,!1),h.removeEventListener("touchcancel",o,!1)},l.indexOfTouch=p,l;function p(t){for(var e=t.identifier,i=0;i<u.length;i++)if(u[i]&&u[i].touch&&u[i].touch.identifier===e)return i;return-1}function e(){t||(t=!0,h.addEventListener("touchstart",i,!1),h.addEventListener("touchmove",n,!1),h.addEventListener("touchend",o,!1),h.addEventListener("touchcancel",o,!1))}function i(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];if(-1===p(i.identifier)&&d<2){var n=0===d,o=u[0]?1:0,s=u[0]?0:1,r=new G;u[o]=r,d++,U(r.touch=i,h,r.position);var a=u[s]?u[s].touch:void 0;if(l.emit("place",i,a),!n){var c=g();v=!1,l.emit("start",c),f=c}}}}function n(t){for(var e=!1,i=0;i<t.changedTouches.length;i++){var n=t.changedTouches[i],o=p(n);-1!==o&&(e=!0,U(u[o].touch=n,h,u[o].position))}if(2===d&&e){var s=g();l.emit("change",s,f),f=s}}function o(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],n=p(i);if(-1!==n){u[n]=null,d--;var o=0===n?1:0,s=u[o]?u[o].touch:void 0;l.emit("lift",i,s)}}v||2===d||(v=!0,l.emit("end"))}function g(){return d<2?0:(t=u[0].position,e=u[1].position,i=e[0]-t[0],n=e[1]-t[1],Math.sqrt(i*i+n*n));var t,e,i,n}}function G(){this.position=[0,0],this.touch=null}function Q(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var V=0;function J(t){var e=+new Date,i=Math.max(0,16-(e-V));return V=e+i,window.setTimeout(t,i)}var _=window.requestAnimationFrame||Q("RequestAnimationFrame")||J,$=window.cancelAnimationFrame||Q("CancelAnimationFrame")||Q("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)},tt=function(t,e,i){if(!i||_!==J)return _.call(window,function(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}}(t,e));t.call(e)};tt.cancel=function(t){t&&$.call(window,t)};var et=function(){function a(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:80,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:12,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];Z(this,a),t===document&&(t=document.scrollingElement||document.documentElement||document.body.parentNode||document.body),this.speed=e,this.smooth=i,this.moving=!1,this.scrollTop=3e3*n,this.pos=this.scrollTop,this.frame=t===document.body&&document.documentElement?document.documentElement:t,t.addEventListener("wheel",r,{passive:o}),t.addEventListener("DOMMouseScroll",r,{passive:o});var s=this;function r(t){t.preventDefault();var e=s.normalizeWheelDelta(t);s.pos+=-e*s.speed,s.moving||s.update(t)}}return c(a,[{key:"normalizeWheelDelta",value:function(t){return t.detail?t.wheelDelta?t.wheelDelta/t.detail/40*(0<t.detail?1:-1):-t.detail/3:t.wheelDelta/120}},{key:"update",value:function(t){this.moving=!0;var e=(this.pos-this.scrollTop)/this.smooth;this.scrollTop+=e,this.onUpdate&&this.onUpdate(e,t);var i=this;1<Math.abs(e)?it(function(){i.update()}):this.moving=!1}}]),a}(),it=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3)};function nt(t,e,i){return e<i?Math.max(Math.min(t,i),e):Math.max(Math.min(t,e),i)}var ot=Math.abs,st=Math.min;function rt(t,e,i,n){var o=ot(t-e);return null==i&&(i=rt.DBL_EPSILON),null==n&&(n=i),o<=i||(o<=n*st(ot(t),ot(e))||t===e)}rt.FLT_EPSILON=1.1920929e-7,rt.DBL_EPSILON=2220446049250313e-31;var at=Math.log10||function(t){return Math.log(t)/Math.log(10)};function ct(t,e,i){var n=t%e;return i||(i=rt.FLT_EPSILON),!n||!(!rt(0,n,i,0)&&!rt(Math.abs(e),Math.abs(n),i,0))}function ht(t,e){var i=Math.floor(at(t)),n=Math.pow(10,i),o=e.map(function(t){return t*n});n=Math.pow(10,i+1),o=o.concat(e.map(function(t){return t*n}));for(var s=0,r=0;r<o.length&&!(t<=(s=o[r]));r++);return s}var lt=function(t,e){e||(e=[0,""]),t=String(t);var i=parseFloat(t,10);return e[0]=i,e[1]=t.match(/[\d.\-\+]*\s*(.*)/)[1]||"",e},ut={ch:8,ex:7.15625,em:16,rem:16,in:96,cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,px:1};var dt=function(t){if("[object Object]"!==Object.prototype.toString.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.getPrototypeOf({})},ft=function(t){h(n,s);var i=p(n);function n(t){var e;return Z(this,n),(e=i.call(this,t))._options=t||{},Object.assign(f(e),t),e}return n}();function vt(t,e){var i=t.replace(/[^\d,]/g,"").split(",");return null==e&&(e=i[3]||1),i[3]=e,"rgba("+i.join(",")+")"}var pt={steps:[1,2,5],distance:20,unit:10,lines:function(t){var e=t.coordinate,i=t.step=ht(e.distance*e.zoom,e.steps);return function(t,e,i){if(null!=t&&"number"!=typeof t)throw new Error("start must be a number or null");if(null!=e&&"number"!=typeof e)throw new Error("stop must be a number or null");if(null!=i&&"number"!=typeof i)throw new Error("step must be a number or null");null==e&&(e=t||0,t=0),null==i&&(i=t<e?1:-1);for(var n=[],o=t<e;o?t<e:e<t;t+=i)n.push(t);return n}(Math.floor(t.offset/i)*i,Math.ceil((t.offset+t.range)/i+1)*i,i)},lineColor:function(t){if(t.lines){var e=t.coordinate,i=vt(e.color,.1),n=vt(e.color,.3),o=t.step,s=Math.ceil(at(o)),r=Math.pow(10,s),a=Math.pow(10,s+1),c=o/10;return t.lines.map(function(t){return ct(t,a,c)?n:ct(t,r,c)?i:null})}},ticks:function(t){if(t.lines){var e=t.coordinate,i=ht(1.1*ht(1.1*t.step,e.steps),e.steps),n=i/10,o=4*t.axisWidth;return t.lines.map(function(t){return ct(t,i,n)?rt(t,0,n)?null:o:null})}},labels:function(t){if(t.lines){var e=t.coordinate,i=ht(1.1*ht(1.1*t.step,e.steps),e.steps),n=i/100;return t.lines.map(function(t){return ct(t,i,n)?rt(t,0,n)?"y"===e.orientation?null:"0":(t=Number((t/100).toFixed(2)),e.format(t)):null})}}},gt=function(){function i(t,e){Z(this,i),Object.assign(this,e),this.orientation=t||"x"}return c(i,[{key:"getCoords",value:function(t){var e=[];if(!t)return e;for(var i=0;i<t.length;i+=1){var n=this.getRatio(t[i]);e.push(n),e.push(0),e.push(n),e.push(1)}return e}},{key:"getRange",value:function(){var t=this.width;return"y"===this.orientation&&(t=this.height),t*this.zoom}},{key:"getRatio",value:function(t){return(t-this.offset)/this.range}},{key:"setOffset",value:function(t){this.offset=t}},{key:"update",value:function(t){t=t||{},Object.assign(this,t),this.range=this.getRange()}}]),i}(),mt=function(t){h(o,ft);var n=p(o);function o(t,e){var i;return Z(this,o),(i=n.call(this,e)).canvas=t,i.context=i.canvas.getContext("2d"),i.state={},i.setDefaults(),i.update(e),i}return c(o,[{key:"render",value:function(){return this.draw(),this}},{key:"getCenterCoords",value:function(){var t=this.state.x,e=N(t.shape,2),i=e[0],n=e[1],o=N(t.padding,4),s=o[0],r=o[1],a=o[2],c=o[3],h=t.opposite.coordinate.getCoords([t.coordinate.axisOrigin],t.opposite),l=s+h[1]*(n-s-a),u=N((t=this.state.y).shape,2);i=u[0],n=u[1];var d=N(t.padding,4);return s=d[0],r=d[1],a=d[2],{x:(c=d[3])+(h=t.opposite.coordinate.getCoords([t.coordinate.axisOrigin],t.opposite))[0]*(i-r-c),y:l}}},{key:"setSize",value:function(t,e){this.setWidth(t),this.setHeight(e)}},{key:"setWidth",value:function(t){this.canvas.width=t}},{key:"setHeight",value:function(t){this.canvas.height=t}},{key:"update",value:function(t){t||(t={});var e=[this.canvas.width,this.canvas.height];return this.state.x=this.calcCoordinate(this.axisX,e,this),this.state.y=this.calcCoordinate(this.axisY,e,this),this.state.x.opposite=this.state.y,this.state.y.opposite=this.state.x,this.emit("update",t),this}},{key:"update2",value:function(t){var e=[this.canvas.width,this.canvas.height];Object.assign(this.center,t),this.state.x=this.calcCoordinate(this.axisX,e,this),this.state.y=this.calcCoordinate(this.axisY,e,this),this.state.x.opposite=this.state.y,this.state.y.opposite=this.state.x,this.emit("update",t),this.axisX.offset=t.x,this.axisX.zoom=1/t.zoom,this.axisY.offset=t.y,this.axisY.zoom=1/t.zoom}},{key:"calcCoordinate",value:function(t,e){var i,n,o,s={coordinate:t,shape:e,grid:this};if(s.range=t.getRange(s),s.offset=nt(t.offset-s.range*nt(.5,0,1),Math.max(t.min,1-Number.MAX_VALUE),Math.min(t.max,Number.MAX_VALUE)-s.range),s.zoom=t.zoom,s.axisColor="number"==typeof t.axisColor?vt(t.color,t.axisColor):t.axisColor||t.color,s.axisWidth=t.axisWidth||t.lineWidth,s.lineWidth=t.lineWidth,s.tickAlign=t.tickAlign,s.labelColor=s.color,"number"==typeof t.padding?s.padding=Array(4).fill(t.padding):t.padding instanceof Function?s.padding=t.padding(s):s.padding=t.padding,"number"==typeof t.fontSize)s.fontSize=t.fontSize;else{var r=lt(t.fontSize);s.fontSize=r[0]*function t(e){if(!e)return null;if(ut[e])return ut[e];var i=lt(e);if(isNaN(i[0])||!i[1])return null;var n=t(i[1]);return"number"==typeof n?i[0]*n:null}(r[1])}if(s.fontFamily=t.fontFamily||"sans-serif",i=t.lines instanceof Function?t.lines(s):t.lines||[],s.lines=i,t.lineColor instanceof Function)s.lineColors=t.lineColor(s);else if(Array.isArray(t.lineColor))s.lineColors=t.lineColor;else{var a=vt(t.color,t.lineColor);"number"!=typeof t.lineColor&&(a=!1===t.lineColor||null==t.lineColor?null:t.color),s.lineColors=Array(i.length).fill(a)}if(t.ticks instanceof Function)n=t.ticks(s);else if(Array.isArray(t.ticks))n=t.ticks;else{var c=!0===t.ticks||!0===t.ticks?2*s.axisWidth:t.ticks||0;n=Array(i.length).fill(c)}return s.ticks=n,o=!0===t.labels?s.lines:t.labels instanceof Function?t.labels(s):Array.isArray(t.labels)?t.labels:dt(t.labels)?t.labels:Array(s.lines.length).fill(null),s.labels=o,dt(n)&&(s.ticks=Array(i.length).fill(0)),dt(o)&&(s.labels=Array(i.length).fill(null)),dt(n)&&Object.keys(n).forEach(function(t,e){s.ticks.push(e),s.lines.push(parseFloat(t)),s.lineColors.push(null),s.labels.push(null)}),dt(o)&&Object.keys(o).forEach(function(t,e){s.labels.push(t),s.lines.push(parseFloat(e)),s.lineColors.push(null),s.ticks.push(null)}),s}},{key:"setDefaults",value:function(){this.pixelRatio=window.devicePixelRatio,this.autostart=!0,this.interactions=!0,this.defaults=Object.assign({type:"linear",name:"",units:"",state:{},minZoom:-1/0,maxZoom:1/0,min:-1/0,max:1/0,offset:0,origin:.5,center:{x:0,y:0,zoom:1},zoom:1,zoomEnabled:!0,panEnabled:!0,labels:!0,fontSize:"11pt",fontFamily:"sans-serif",padding:0,color:"rgb(0,0,0,1)",lines:!0,tick:8,tickAlign:.5,lineWidth:1,distance:13,style:"lines",lineColor:.4,axis:!0,axisOrigin:0,axisWidth:2,axisColor:.8,getCoords:function(){return[0,0,0,0]},getRatio:function(){return 0},format:function(t){return t}},pt,this._options),this.axisX=new gt("x",this.defaults),this.axisY=new gt("y",this.defaults),this.axisX=Object.assign({},this.defaults,{orientation:"x",offset:this.center.x,getCoords:function(t,e){var i=[];if(!t)return i;for(var n=0;n<t.length;n+=1){var o=e.coordinate.getRatio(t[n],e);i.push(o),i.push(0),i.push(o),i.push(1)}return i},getRange:function(t){return t.shape[0]*t.coordinate.zoom},getRatio:function(t,e){return(t-e.offset)/e.range}}),this.axisY=Object.assign({},this.defaults,{orientation:"y",offset:this.center.y,getCoords:function(t,e){var i=[];if(!t)return i;for(var n=0;n<t.length;n+=1){var o=e.coordinate.getRatio(t[n],e);i.push(0),i.push(o),i.push(1),i.push(o)}return i},getRange:function(t){return t.shape[1]*t.coordinate.zoom},getRatio:function(t,e){return 1-(t-e.offset)/e.range}}),Object.assign(this,this.defaults),Object.assign(this,this._options),this.center=new y(this.center)}},{key:"draw",value:function(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawLines(this.state.x),this.drawLines(this.state.y),this}},{key:"drawLines",value:function(t){if(t&&t.coordinate){var e=this.context,i=N(t.shape,2),n=i[0],o=i[1],s=N(t.padding,4),r=s[0],a=s[1],c=s[2],h=s[3],l=t.opposite.coordinate.getRatio(t.coordinate.axisOrigin,t.opposite);l=nt(l,0,1);var u=t.coordinate.getCoords(t.lines,t);e.lineWidth=1;for(var d=0,f=0;d<u.length;d+=4,f+=1){var v=t.lineColors[f];if(v){e.strokeStyle=v,e.beginPath();var p=0+h+u[d]*(n-a-h),g=0+r+u[d+1]*(o-c-r),m=0+h+u[d+2]*(n-a-h),y=0+r+u[d+3]*(o-c-r);e.moveTo(p,g),e.lineTo(m,y),e.stroke(),e.closePath()}}for(var b,w,k=[],x=0;x<u.length;x+=4){var A=u[x],O=u[x+1],C=u[x+2]-A,j=u[x+3]-O,E=(b=C,w=j,Math.sqrt(b*b+w*w));k.push(C/E),k.push(j/E)}var M=[];t.labelCoords=[];for(var L=t.ticks,P=0,R=0,W=0;P<k.length;W+=1,P+=2,R+=4){var z=u[R],S=u[R+1],T=(u[R+2]-z)*l,I=(u[R+3]-S)*l,F=[k[P]*L[W]/(n-h-a),k[P+1]*L[W]/(o-r-c)];M.push(k[P]*(T+F[0]*t.tickAlign)+z),M.push(k[P+1]*(I+F[1]*t.tickAlign)+S),M.push(k[P]*(T-F[0]*(1-t.tickAlign))+z),M.push(k[P+1]*(I-F[1]*(1-t.tickAlign))+S),t.labelCoords.push(k[P]*T+z),t.labelCoords.push(k[P+1]*I+S)}if(L.length){e.lineWidth=t.axisWidth/2,e.beginPath();for(var Y=0,B=0;Y<M.length;Y+=4,B+=1)if(!rt(t.lines[B],t.opposite.coordinate.axisOrigin)){var D=0+h+M[Y]*(n-h-a),X=0+r+M[Y+1]*(o-r-c),U=0+h+M[Y+2]*(n-h-a),q=0+r+M[Y+3]*(o-r-c);e.moveTo(D,X),e.lineTo(U,q)}e.strokeStyle=t.axisColor,e.stroke(),e.closePath()}if(t.coordinate.axis&&t.axisColor){var G=t.opposite.coordinate.getCoords([t.coordinate.axisOrigin],t.opposite);e.lineWidth=t.axisWidth/2;var Q=0+h+nt(G[0],0,1)*(n-a-h),Z=0+r+nt(G[1],0,1)*(o-r-c),H=0+h+nt(G[2],0,1)*(n-a-h),K=0+r+nt(G[3],0,1)*(o-r-c);e.beginPath(),e.moveTo(Q,Z),e.lineTo(H,K),e.strokeStyle=t.axisColor,e.stroke(),e.closePath()}this.drawLabels(t)}}},{key:"drawLabels",value:function(t){if(t.labels){var e=this.context,i=N(t.shape,2),n=i[0],o=i[1],s=N(t.padding,4),r=s[0],a=s[1],c=s[2],h=s[3];e.font="300 ".concat(t.fontSize,"px ").concat(t.fontFamily),e.fillStyle=t.labelColor,e.textBaseline="top";for(var l=t.fontSize,u=t.axisWidth+1.5,d=t.tickAlign<.5?-l-2*t.axisWidth:2*t.axisWidth,f="y"===t.coordinate.orientation&&!t.opposite.disabled,v=0;v<t.labels.length;v+=1){var p=t.labels[v];if(null!=p&&(!f||!rt(t.lines[v],t.opposite.coordinate.axisOrigin))){var g=e.measureText(p).width,m=t.labelCoords[2*v]*(n-h-a)+u+h;"y"===t.coordinate.orientation&&(m=nt(m,u,n-g-1-t.axisWidth),p*=-1);var y=t.labelCoords[2*v+1]*(o-r-c)+d+r;"x"===t.coordinate.orientation&&(y=nt(y,0,o-l-d)),e.fillText(p,m,y)}}}}}]),o}(),yt=function(n){return function(t){h(i,n);var e=p(i);function i(){return Z(this,i),e.apply(this,arguments)}return c(i,[{key:"setMode",value:function(t){switch(this.mode=t){case b.SELECT:this.canvas.isDrawingMode=!1,this.canvas.interactive=!0,this.canvas.selection=!0,this.canvas.hoverCursor="default",this.canvas.moveCursor="default";break;case b.GRAB:this.canvas.isDrawingMode=!1,this.canvas.interactive=!1,this.canvas.selection=!1,this.canvas.discardActiveObject(),this.canvas.hoverCursor="move",this.canvas.moveCursor="move";break;case b.MEASURE:this.canvas.isDrawingMode=!0,this.canvas.freeDrawingBrush.color="transparent",this.canvas.discardActiveObject();break;case b.DRAW:this.canvas.isDrawingMode=!0}}},{key:"setModeAsDraw",value:function(){this.setMode(b.DRAW)}},{key:"setModeAsSelect",value:function(){this.setMode(b.SELECT)}},{key:"setModeAsMeasure",value:function(){this.setMode(b.MEASURE)}},{key:"setModeAsGrab",value:function(){this.setMode(b.GRAB)}},{key:"isSelectMode",value:function(){return this.mode===b.SELECT}},{key:"isGrabMode",value:function(){return this.mode===b.GRAB}},{key:"isMeasureMode",value:function(){return this.mode===b.MEASURE}},{key:"isDrawMode",value:function(){return this.mode===b.DRAW}}]),i}()},bt=function(){function e(t){if(Z(this,e),(t=t||{}).hasBorders=!1,t.selectable=!1,t.hasControls=!1,t.class="measurer",t.scale=t.scale||1,this.options=t||{},this.start=this.options.start,this.end=this.options.end,this.canvas=this.options.map.canvas,this.completed=!1,!this.start||!this.end)throw new Error("start must be defined");this.draw()}return c(e,[{key:"clear",value:function(){var e=this;this.objects&&this.objects.forEach(function(t){e.canvas.remove(t)})}},{key:"draw",value:function(){var e=this;this.clear();var t=this.start,i=this.end;t=new y(t),i=new y(i);var n=t.add(i).multiply(.5);this.line=new fabric.Line([t.x,t.y,i.x,i.y],{stroke:this.options.stroke||"#3e82ff",hasControls:!1,hasBorders:!1,selectable:!1,evented:!1,strokeDashArray:[5,5]});var o={left:t.x,top:t.y,strokeWidth:1,radius:this.options.radius||1,fill:this.options.fill||"#3e82ff",stroke:this.options.stroke||"#3e82ff",hasControls:!1,hasBorders:!1},s={left:t.x,top:t.y,strokeWidth:1,radius:this.options.radius||5,fill:this.options.fill||"#3e82ff33",stroke:this.options.stroke||"#3e82ff",hasControls:!1,hasBorders:!1};this.circle1=new fabric.Circle(s),this.circle2=new fabric.Circle(a(a({},s),{},{left:i.x,top:i.y})),this.circle11=new fabric.Circle(o),this.circle22=new fabric.Circle(a(a({},o),{},{left:i.x,top:i.y}));var r=Math.round(t.distanceFrom(i));r="".concat(r/100," m"),this.text=new fabric.Text(r,{textBackgroundColor:"black",fill:"white",left:n.x,top:n.y-10,fontSize:12,hasControls:!1,hasBorders:!1,selectable:!1,evented:!1}),this.objects=[this.line,this.text,this.circle11,this.circle22,this.circle1,this.circle2],this.objects.forEach(function(t){e.canvas.add(t)}),this.line.hasControls=!1,this.line.hasBorders=!1,this.line.selectable=!1,this.line.evented=!1,this.registerListeners()}},{key:"setStart",value:function(t){this.start=t,this.draw()}},{key:"setEnd",value:function(t){this.end=t,this.draw()}},{key:"complete",value:function(){this.completed=!0}},{key:"registerListeners",value:function(){var e=this;this.circle2.on("moving",function(t){e.setEnd(t.pointer)}),this.circle1.on("moving",function(t){e.setStart(t.pointer)})}},{key:"applyScale",value:function(t){this.start.x*=t,this.start.y*=t,this.end.x*=t,this.end.y*=t,this.draw()}}]),e}(),wt=function(){function e(t){Z(this,e),this.map=t,this.measurer=null}return c(e,[{key:"onMouseMove",value:function(t){var e={x:t.absolutePointer.x,y:t.absolutePointer.y};this.measurer&&!this.measurer.completed&&(this.measurer.setEnd(e),this.map.canvas.requestRenderAll())}},{key:"onClick",value:function(t){var e={x:t.absolutePointer.x,y:t.absolutePointer.y};this.measurer?this.measurer.completed||(this.measurer.setEnd(e),this.measurer.complete()):this.measurer=new bt({start:e,end:e,map:this.map})}}]),e}(),kt=function(t){return new xt(t)},xt=function(){function e(t){Z(this,e),this.superclass=t||function(){return function t(){Z(this,t)}}()}return c(e,[{key:"with",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce(function(t,e){return e(t)},this.superclass)}}]),e}(),At=function(t){h(r,kt(ft)["with"](yt));var s=p(r);function r(t,e){var i;Z(this,r),(i=s.call(this,e)).defaults=Object.assign({},w),Object.assign(f(i),i.defaults),Object.assign(f(i),i._options),i.center=new y(i.center),i.container=t||document.body;var n=document.createElement("canvas");i.container.appendChild(n),n.setAttribute("id","indoors-map-canvas"),n.width=i.width||i.container.clientWidth,n.height=i.height||i.container.clientHeight,i.canvas=new fabric.Canvas(n,{preserveObjectStacking:!0,renderOnAddRemove:!0}),i.context=i.canvas.getContext("2d"),i.on("render",function(){i.autostart&&i.clear()}),i.originX=-i.canvas.width/2,i.originY=-i.canvas.height/2,i.canvas.absolutePan({x:i.originX,y:i.originY}),i.x=i.center.x,i.y=i.center.y,i.dx=0,i.dy=0;try{i.addFloorPlan()}catch(t){console.error(t)}i.showGrid&&i.addGrid(),i.setMode(i.mode||b.GRAB);var o=f(i);return function(n,i){n instanceof Function&&(i=n,n=document.documentElement||document.body),"string"==typeof n&&(n=document.querySelector(n));var o,s={x:0,y:0},r=0,a=0,c=!0,t=function(t){c=!0};n.addEventListener("mousedown",t);var e=function(t){s=B(t)};n.addEventListener("mousemove",e);var h=function(t){t&&(s=B(t))};n.addEventListener("wheel",h),n.addEventListener("touchstart",t,!!function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e}()&&{passive:!0}),n.addEventListener("contextmenu",function(t){return t.preventDefault(),!1},!1);var l=0,u=0;o=new D({source:n,update:function(t,e){c&&(c=!1,r=s.x,a=s.y);var i={target:n,type:"mouse",dx:t-u,dy:e-l,dz:0,x:s.x,y:s.y,x0:r,y0:a,isRight:s.isRight};u=t,l=e,g(i)},stop:function(){g({target:n,type:"mouse",dx:0,dy:0,dz:0,x:s.x,y:s.y,x0:r,y0:a})},multiplier:1,friction:.75}),new et(n,80,12,0).onUpdate=function(t,e){g({target:n,type:"mouse",dx:0,dy:0,dz:t,x:s.x,y:s.y,x0:s.x,y0:s.y})};var d,f,v,p=q(n);function g(e){null==v?v=tt(function(){if(i(e),v=null,f){var t=f;f=null,g(t)}}):f?(f.dx+=e.dx,f.dy+=e.dy,f.dz+=e.dz,f.x=e.x,f.y=e.y):f=e}p.on("start",function(t){var e=p.fingers[0],i=p.fingers[1];d=[.5*i.position[0]+.5*e.position[0],.5*i.position[1]+.5*e.position[1]],o&&o.pause()}),p.on("end",function(){d&&(d=null,o&&o.resume())}),p.on("change",function(t,e){p.pinching&&d&&g({target:n,type:"touch",dx:0,dy:0,dz:2*-(t-e),x:d[0],y:d[1],x0:d[0],y0:d[0]})})}(i.container,function(t){o.panzoom(t)}),i.registerListeners(),setTimeout(function(){i.emit("ready",f(i))},300),i.measurement=new wt(f(i)),i}return c(r,[{key:"addFloorPlan",value:function(){if(this.floorplan){var e=this;this.floorplan.on("load",function(t){e.addLayer(t)})}}},{key:"addLayer",value:function(t){if(t.shape){if(this.canvas.add(t.shape),this.canvas._objects.sort(function(t,e){return t.zIndex-e.zIndex}),t.shape.keepOnZoom){var e=1/this.zoom;t.shape.set("scaleX",e),t.shape.set("scaleY",e),t.shape.setCoords(),this.emit("".concat(t.class,"scaling"),t)}t.class&&this.emit("".concat(t.class,":added"),t),this.canvas.requestRenderAll()}else console.error("shape is undefined")}},{key:"removeLayer",value:function(t){t&&t.shape&&(t.class&&this.emit("".concat(t.class,":removed"),t),this.canvas.remove(t.shape))}},{key:"addGrid",value:function(){this.gridCanvas=this.cloneCanvas(),this.gridCanvas.setAttribute("id","indoors-grid-canvas"),this.grid=new mt(this.gridCanvas,this),this.grid.draw()}},{key:"moveTo",value:function(t,e){void 0!==e&&(t.zIndex=e),this.canvas.moveTo(t.shape,t.zIndex)}},{key:"cloneCanvas",value:function(t){t=t||this.canvas;var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.wrapperEl.appendChild(e),e}},{key:"setZoom",value:function(t){var e=this,i=this.canvas,n=i.width,o=i.height;this.zoom=nt(t,this.minZoom,this.maxZoom),this.dx=0,this.dy=0,this.x=n/2,this.y=o/2,this.update(),T(function(){e.update()})}},{key:"getBounds",value:function(){var e=1/0,i=-1/0,n=1/0,o=-1/0;return this.canvas.forEachObject(function(t){t.getBounds().forEach(function(t){e=Math.min(e,t.x),i=Math.max(i,t.x),n=Math.min(n,t.y),o=Math.max(o,t.y)})}),[new y(e,n),new y(i,o)]}},{key:"fitBounds",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100;this.onResize();var i=this.canvas,n=i.width,o=i.height;this.originX=-this.canvas.width/2,this.originY=-this.canvas.height/2;var s=this.getBounds();this.center.x=(s[0].x+s[1].x)/2,this.center.y=-(s[0].y+s[1].y)/2;var r=n/(Math.abs(s[0].x-s[1].x)+e),a=o/(Math.abs(s[0].y-s[1].y)+e);this.zoom=Math.min(r,a),this.canvas.setZoom(this.zoom),this.canvas.absolutePan({x:this.originX+this.center.x*this.zoom,y:this.originY-this.center.y*this.zoom}),this.update(),T(function(){t.update()})}},{key:"setCursor",value:function(t){this.container.style.cursor=t}},{key:"reset",value:function(){var t=this,e=this.canvas,i=e.width,n=e.height;this.zoom=this._options.zoom||1,this.center=new y,this.originX=-this.canvas.width/2,this.originY=-this.canvas.height/2,this.canvas.absolutePan({x:this.originX,y:this.originY}),this.x=i/2,this.y=n/2,this.update(),T(function(){t.update()})}},{key:"onResize",value:function(t,e){var i=this.canvas.width,n=this.canvas.height;t=t||this.container.clientWidth,e=e||this.container.clientHeight,this.canvas.setWidth(t),this.canvas.setHeight(e),this.grid&&this.grid.setSize(t,e);var o=t/2-i/2,s=e/2-n/2;this.canvas.relativePan({x:o,y:s}),this.update()}},{key:"update",value:function(){var t=this.canvas;this.grid&&this.grid.update2({x:this.center.x,y:this.center.y,zoom:this.zoom}),this.emit("update",this),this.grid&&this.grid.render(),t.zoomToPoint(new y(this.x,this.y),this.zoom),this.isGrabMode()||this.isRight?(t.relativePan(new y(this.dx,this.dy)),this.emit("panning"),this.setCursor("grab")):this.setCursor("pointer");var e=Date.now();if(this.lastUpdatedTime||!(Math.abs(this.lastUpdatedTime-e)<100)){this.lastUpdatedTime=e;for(var i=t.getObjects(),n=!1,o=0;o<i.length;o+=1){var s=i[o];s.keepOnZoom&&(s.set("scaleX",1/this.zoom),s.set("scaleY",1/this.zoom),s.setCoords(),n=!0,this.emit("".concat(s.class,"scaling"),s))}n&&t.requestRenderAll()}}},{key:"panzoom",value:function(t){var e=this.canvas,i=e.width,n=e.height,o=nt(-t.dz,.75*-n,.75*n)/n,s=1/this.zoom,r=s*(1-o);r=nt(r,this.minZoom,this.maxZoom);var a=this.center,c=a.x,h=a.y;(this.isGrabMode()||t.isRight?(c-=s*t.dx,h+=s*t.dy,this.setCursor("grab")):this.setCursor("pointer"),this.zoomEnabled)&&(c-=i*(r-s)*(t.x/i-.5),h-=n*(r-s)*(.5-t.y/n));this.center.setX(c),this.center.setY(h),this.zoom=1/r,this.dx=t.dx,this.dy=t.dy,this.x=t.x0,this.y=t.y0,this.isRight=t.isRight,this.update()}},{key:"setView",value:function(t){var e=this;this.dx=0,this.dy=0,this.x=0,this.y=0,t.y*=-1;var i=this.center.x-t.x,n=-this.center.y+t.y;this.center.copy(t),this.canvas.relativePan(new y(i*this.zoom,n*this.zoom)),this.canvas.renderAll(),this.update(),T(function(){e.update()})}},{key:"registerListeners",value:function(){var s=this,r=this;this.canvas.on("object:scaling",function(t){if(t.target.class)return r.emit("".concat(t.target.class,":scaling"),t.target.parent),void t.target.parent.emit("scaling",t.target.parent);var e=t.target;if(e.getObjects){var i=e.getObjects();e.removeWithUpdate();for(var n=0;n<i.length;n+=1){var o=i[n];o.orgYaw=o.parent.yaw||0,o.fire("moving",o.parent),r.emit("".concat(o.class,":moving"),o.parent)}r.update(),r.canvas.requestRenderAll()}}),this.canvas.on("object:rotating",function(t){if(t.target.class)return r.emit("".concat(t.target.class,":rotating"),t.target.parent,t.target.angle),void t.target.parent.emit("rotating",t.target.parent,t.target.angle);var e=t.target;if(e.getObjects){for(var i=e.getObjects(),n=0;n<i.length;n+=1){var o=i[n];"marker"===o.class&&(o._set("angle",-e.angle),o.parent.yaw=-e.angle+(o.orgYaw||0),o.fire("moving",o.parent),r.emit("".concat(o.class,":moving"),o.parent),o.fire("rotating",o.parent),r.emit("".concat(o.class,":rotating"),o.parent))}s.update()}}),this.canvas.on("object:moving",function(t){if(t.target.class)return r.emit("".concat(t.target.class,":moving"),t.target.parent),void t.target.parent.emit("moving",t.target.parent);var e=t.target;if(e.getObjects){for(var i=e.getObjects(),n=0;n<i.length;n+=1){var o=i[n];o.class&&(o.fire("moving",o.parent),r.emit("".concat(o.class,":moving"),o.parent))}s.update()}}),this.canvas.on("object:moved",function(t){if(t.target.class)return r.emit("".concat(t.target.class,"dragend"),t),r.emit("".concat(t.target.class,":moved"),t.target.parent),t.target.parent.emit("moved",t.target.parent),void s.update();var e=t.target;if(e.getObjects){for(var i=e.getObjects(),n=0;n<i.length;n+=1){var o=i[n];o.class&&(o.fire("moved",o.parent),r.emit("".concat(o.class,":moved"),o.parent))}s.update()}}),this.canvas.on("selection:cleared",function(t){var e=t.deselected;if(e&&e.length)for(var i=0;i<e.length;i+=1){var n=e[i];"marker"===n.class&&(n._set("angle",0),n._set("scaleX",1/r.zoom),n._set("scaleY",1/r.zoom),n.parent&&(n.parent.inGroup=!1),n.fire("moving",n.parent))}}),this.canvas.on("selection:created",function(t){var e=t.selected;if(e&&!(e.length<2))for(var i=0;i<e.length;i+=1){var n=e[i];n.class&&n.parent&&(n.parent.inGroup=!0,n.orgYaw=n.parent.yaw||0)}}),this.canvas.on("selection:updated",function(t){var e=t.selected;if(e&&!(e.length<2))for(var i=0;i<e.length;i+=1){var n=e[i];n.class&&n.parent&&(n.parent.inGroup=!0,n.orgYaw=n.parent.yaw||0)}}),this.canvas.on("mouse:down",function(t){r.dragObject=t.target}),this.canvas.on("mouse:move",function(t){s.isMeasureMode()&&s.measurement.onMouseMove(t),r.dragObject&&r.dragObject.clickable&&(r.dragObject===t.target?r.dragObject.dragging=!0:r.dragObject.dragging=!1),s.isRight=!1,"which"in t.e?s.isRight=3===t.e.which:"button"in t.e&&(s.isRight=2===t.e.button),r.emit("mouse:move",t)}),this.canvas.on("mouse:up",function(t){if(s.isMeasureMode()&&s.measurement.onClick(t),s.isRight=!1,s.dx=0,s.dy=0,r.dragObject&&t.target&&t.target.selectable||(t.target=null,r.emit("mouse:click",t)),r.dragObject&&r.dragObject.clickable){if(r.dragObject!==t.target)return;r.dragObject.dragging||r.modeToggleByKey||r.emit("".concat(r.dragObject.class,":click"),r.dragObject.parent),r.dragObject.dragging=!1}r.dragObject=null}),window.addEventListener("resize",function(){r.onResize()})}},{key:"unregisterListeners",value:function(){this.canvas.off("object:moving"),this.canvas.off("object:moved")}},{key:"getMarkerById",value:function(t){for(var e=this.canvas.getObjects(),i=0;i<e.length;i+=1){var n=e[i];if("marker"===n.class&&n.id===t)return n.parent}return null}},{key:"getMarkers",value:function(){for(var t=[],e=this.canvas.getObjects(),i=0;i<e.length;i+=1){var n=e[i];"marker"===n.class&&t.push(n.parent)}return t}}]),r}(),Ot=function(t){h(n,fabric.Group);var i=p(n);function n(t,e){return Z(this,n),e=e||{},i.call(this,t,e)}return c(n,[{key:"getBounds",value:function(){var t=[];return t.push(new y(this.left-this.width/2,this.top-this.height/2)),t.push(new y(this.left+this.width/2,this.top+this.height/2)),t}}]),n}(),Ct=function(t){h(n,ft);var i=p(n);function n(t){var e;return Z(this,n),(e=i.call(this,t)).label=void 0!==e.label?e.label:null,e.draggable=e.draggable||!1,e.zIndex=e.zIndex||1,e.opacity=e.opacity||1,e.keepOnZoom=e.keepOnZoom||!1,e.clickable=e.clickable||!1,e.hoverCursor=e.hoverCursor||e.clickable?"pointer":"default",e.moveCursor=e.moveCursor||"move",e.style={zIndex:e.zIndex,class:e.class,parent:f(e),keepOnZoom:e.keepOnZoom,id:e.id,hasControls:!1,hasBorders:!1,lockMovementX:!e.draggable,lockMovementY:!e.draggable,draggable:e.draggable,clickable:e.clickable,evented:e.clickable,selectable:e.draggable,hoverCursor:e.hoverCursor,moveCursor:e.moveCursor},e}return c(n,[{key:"setOptions",value:function(e){var i=this;this.shape&&(Object.keys(e).forEach(function(t){i.shape.set(t,e[t])}),this.shape.canvas&&this.shape.canvas.renderAll())}},{key:"addTo",value:function(t){t?(this._map=t,this._map.addLayer(this)):this._map&&this._map.removeLayer(this)}}]),n}(),jt=function(t){h(n,Ct);var i=p(n);function n(t){var e;return Z(this,n),(e=i.call(this,t)).width=e.width||-1,e.height=e.height||-1,e.position=new y(e.position),e.class="floorplan",e.load(),e}return c(n,[{key:"load",value:function(){var n=this,t=this.url.lastIndexOf(".");"svg"===this.url.substr(t+1,3)?fabric.loadSVGFromURL(this.url,function(t,e){t=t.filter(function(t){return"grid"!==t.id});var i=fabric.util.groupSVGElements(t,e);n.setImage(i)}):fabric.Image.fromURL(this.url,function(t){n.setImage(t)},{selectable:!1,opacity:this.opacity}),this.handler=new fabric.Rect({left:0,top:0,width:.1,height:.1,stroke:"black",fill:"",hasControls:!1,hasBorders:!1})}},{key:"setImage",value:function(t){this.shape&&this.image&&this.shape.remove(this.image);var e=t.width/t.height;-1===this.width&&-1===this.height?(this.width=t.width,this.height=t.height):-1===this.width?this.width=this.height*e:-1===this.height&&(this.height=this.width/e),t.originalWidth=t.width,t.originalHeight=t.height,this.image=t.scaleToWidth(this.width,!0),this.scaleX=t.scaleX+0,this.scaleY=t.scaleY+0,this.drawShape()}},{key:"drawShape",value:function(){if(this.shape)return this.shape.addWithUpdate(this.image),void this.emit("load",this);this.shape=new Ot([this.image,this.handler],{selectable:!1,draggable:!1,left:this.position.x,top:this.position.y,parent:this,lockMovementX:!0,lockMovementY:!0,class:this.class,zIndex:this.zIndex}),this.emit("load",this)}},{key:"setWidth",value:function(t){this.width=t,this.onResize()}},{key:"setHeight",value:function(t){this.height=t,this.onResize()}},{key:"setOpacity",value:function(t){this.opacity=t,this.image.set("opacity",t),this.image.canvas&&this.image.canvas.renderAll()}},{key:"setPosition",value:function(t){this.position=new y(t),this.shape&&this.shape.set({left:this.position.x,top:this.position.y})}},{key:"setUrl",value:function(t){this.url=t,this.load()}},{key:"onResize",value:function(t,e){void 0!==t&&(this.width=t),void 0!==e&&(this.height=e);var i=this.image.width/this.image.height;-1===this.width&&-1===this.height?(this.width=this.image.width,this.height=this.image.height):-1===this.width?this.width=this.height/i:-1===this.height&&(this.height=this.width*i),this.image=this.image.scaleToWidth(this.width),this.shape.addWithUpdate()}}]),n}(),Et=function(t){h(o,fabric.Line);var n=p(o);function o(t,e){var i;return Z(this,o),(e=e||{}).strokeWidth=e.strokeWidth||1,e.class="line",(i=n.call(this,t,e))._strokeWidth=e.strokeWidth,i}return c(o,[{key:"_renderStroke",value:function(t){var e=this._strokeWidth/this.canvas.getZoom();this.strokeWidth=.01<e?e:.01,g(l(o.prototype),"_renderStroke",this).call(this,t),this.setCoords()}}]),o}(),Mt=function(t){h(s,Ct);var o=p(s);function s(t,e,i){var n;return Z(this,s),(i=i||{}).zIndex=i.zIndex||10,i.class="connector",n=o.call(this,i),t&&e?(n.start=t,n.end=e,n.strokeWidth=n.strokeWidth||1,Object.assign(n.style,{strokeWidth:n.strokeWidth,stroke:n.color||"grey",fill:n.fill||!1,selectable:!1}),n.draw(),n.registerListeners(),n):(console.error("start or end is missing"),v(n))}return c(s,[{key:"registerListeners",value:function(){var t=this;this.start.on("update:links",function(){t.shape.set({x1:t.start.position.x,y1:t.start.position.y})}),this.end.on("update:links",function(){t.shape.set({x2:t.end.position.x,y2:t.end.position.y})})}},{key:"draw",value:function(){this.shape=new Et([this.start.position.x,this.start.position.y,this.end.position.x,this.end.position.y],this.style)}},{key:"redraw",value:function(){this.shape.set({x1:this.start.position.x,y1:this.start.position.y,x2:this.end.position.x,y2:this.end.position.y})}},{key:"setStart",value:function(t){this.start=t,this.redraw()}},{key:"setEnd",value:function(t){this.end=t,this.redraw()}},{key:"setColor",value:function(t){this.color=t,this.style.stroke=t,this.shape.set("stroke",t),this.shape.canvas&&this.shape.canvas.renderAll()}},{key:"setStrokeWidth",value:function(t){this.strokeWidth=t,this.style.strokeWidth=t,this.shape.set("strokeWidth",t),this.shape.canvas&&this.shape.canvas.renderAll()}}]),s}(),Lt=function(t){h(s,Ct);var o=p(s);function s(t,e){var i;Z(this,s),(e=e||{}).zIndex=e.zIndex||100,e.keepOnZoom=void 0===e.keepOnZoom||e.keepOnZoom,e.position=new y(t),e.rotation=e.rotation||0,e.yaw=e.yaw||0,e.clickable=void 0===e.clickable||e.clickable,e.class="marker";var n=f(i=o.call(this,e));return i.text=i.text||"",i.size=i.size||10,i.textColor=i.textColor||"black",i.fill=i.fill||"white",i.stroke=i.stroke||"red",Object.assign(i.style,{left:i.position.x,top:i.position.y,angle:i.rotation,yaw:i.yaw,clickable:i.clickable}),i.text&&(i.textObj=new fabric.Text(i.text,{fontSize:i.size,fill:i.textColor})),i.icon?fabric.Image.fromURL(i.icon.url,function(t){n.image=t.scaleToWidth(i.size),i.init()},{selectable:!1,evented:i.evented,clickable:i.clickable,opacity:i.opacity}):(i.circle=new fabric.Circle({radius:i.size,strokeWidth:2,stroke:i.stroke,fill:i.fill}),i.init()),i}return c(s,[{key:"init",value:function(){var t=this,e=[];this.image&&e.push(this.image),this.circle&&e.push(this.circle),this.textObj&&e.push(this.textObj),this.shape=new Ot(e,this.style),this.links=this.links||[],this.addLinks(),this.registerListeners(),T(function(){t.emit("ready")})}},{key:"registerListeners",value:function(){var e=this;this.shape.on("moving",function(){e.onShapeDrag()}),this.shape.on("rotating",function(){e.emit("rotating")}),this.shape.on("mousedown",function(t){e.onShapeMouseDown(t)}),this.shape.on("mousemove",function(t){e.onShapeMouseMove(t)}),this.shape.on("mouseup",function(t){e.onShapeMouseUp(t)}),this.shape.on("mouseover",function(){e.emit("mouseover",e)}),this.shape.on("mouseout",function(){e.emit("mouseout",e)})}},{key:"setPosition",value:function(t){this.position=new y(t),this.shape&&(this.shape.set({left:this.position.x,top:this.position.y}),this.emit("update:links"),this.shape.canvas&&this.shape.canvas.renderAll())}},{key:"setRotation",value:function(t){this.rotation=t,this.shape&&(this.shape.set({angle:this.rotation}),this.shape.canvas&&this.shape.canvas.renderAll())}},{key:"setOptions",value:function(e){var i=this;this.shape&&(Object.keys(e).forEach(function(t){switch(t){case"textColor":i.setTextColor(e[t]);break;case"stroke":i.setStroke(e[t]);break;case"fill":i.setColor(e[t])}}),this.shape.canvas&&this.shape.canvas.renderAll())}},{key:"setTextColor",value:function(t){this.text&&this.textObj&&(this.textObj.setColor(t),this.textObj.canvas.renderAll())}},{key:"setText",value:function(t){this.text&&this.textObj&&(this.textObj.set({text:t}),this.textObj.canvas.renderAll())}},{key:"setStroke",value:function(t){this.circle&&this.circle.set("stroke",t)}},{key:"setColor",value:function(t){this.circle&&this.circle.setColor(t)}},{key:"setLinks",value:function(t){this.links=t,this.addLinks()}},{key:"setSize",value:function(t){this.image?(this.image.scaleToWidth(t),this.image.canvas&&this.image.canvas.renderAll()):this.circle&&this.circle.setRadius(t)}},{key:"addLinks",value:function(){var i=this;this.connectors=[],this.links.forEach(function(t){var e=new Mt(i,t);i.connectors.push(e)}),this.addConnectors()}},{key:"addConnectors",value:function(){var e=this;this.connectors.forEach(function(t){e._map.addLayer(t)})}},{key:"onAdded",value:function(){this.addConnectors()}},{key:"onShapeDrag",value:function(){var t=N(this.shape.calcTransformMatrix(),6),e=t[4],i=t[5];this.position=new y(e,i),this.emit("update:links"),this.emit("moving")}},{key:"onShapeMouseDown",value:function(t){this.dragStart=t}},{key:"onShapeMouseMove",value:function(t){if(this.dragStart){this.emit("dragstart");var e=new fabric.Point(t.pointer.x,t.pointer.y),i=new fabric.Point(this.dragStart.pointer.x,this.dragStart.pointer.y);3<e.distanceFrom(i)&&(this.dragStart=null,this.dragging=!0)}this.dragging?this.emit("drag"):this.emit("hover")}},{key:"onShapeMouseUp",value:function(){this.dragging?this.emit("moved"):this.emit("click"),this.dragStart=null,this.dragging=!1}}]),s}(),Pt=function(t){h(n,fabric.Image);var i=p(n);function n(t){var e;return Z(this,n),(e=i.call(this,t)).defaults=Object.assign({},x),Object.assign({},e.defaults),Object.assign({},e._options),e}return n}(),Rt=function(t){h(o,Ct);var n=p(o);function o(t,e){var i;return Z(this,o),(e=e||{}).points=t||[],(i=n.call(this,e)).lines=[],i.class="polyline",i.strokeWidth=1,i.lineOptions={strokeWidth:i.strokeWidth,stroke:i.color||"grey",fill:i.fill||!1},i.shape=new Ot([],{selectable:!1,hasControls:!1,class:i.class,parent:f(i)}),i.setPoints(i._points),i}return c(o,[{key:"addPoint",value:function(t){if(this.points.push(new y(t)),1<this.points.length){var e=this.points.length-1,i=this.points.length-2,n=this.points[e],o=this.points[i],s=new fabric.Line(n.getArray().concat(o.getArray()),this.lineOptions);this.lines.push(s),this.shape.addWithUpdate(s)}}},{key:"setStrokeWidth",value:function(e){this.lines.forEach(function(t){t.setStrokeWidth(e)})}},{key:"setPoints",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.removeLines(),this.points=[];for(var e=0;e<t.length;e+=1){var i=new y(t[e]);this.points.push(i),this.addPoint()}}},{key:"removeLines",value:function(){for(var t=0;t<this.lines.length;t+=1)this.shape.remove(this.lines[t]);this.lines=[]}}]),o}(),Wt=function(t){h(i,fabric.Circle);var e=p(i);function i(){return Z(this,i),e.apply(this,arguments)}return i}(),zt=function(t){h(o,fabric.Rect);var n=p(o);function o(t,e){var i;return Z(this,o),(e=e||{}).strokeWidth=e.strokeWidth||1,e.class="rect",(i=n.call(this,t,e))._strokeWidth=e.strokeWidth,i}return c(o,[{key:"_renderStroke",value:function(t){this.strokeWidth=this._strokeWidth/this.canvas.getZoom(),g(l(o.prototype),"_renderStroke",this).call(this,t)}}]),o}(),St=function(t){h(o,Ct);var n=p(o);function o(t,e){var i;return Z(this,o),(e=e||{}).bounds=t,e.zIndex=e.zIndex||50,e.class="markergroup",(i=n.call(this,e)).bounds?(i.style={strokeWidth:1,stroke:i.stroke||"black",fill:i.color||"#88888822",class:i.class,zIndex:i.zIndex,parent:f(i)},i.draw(),i):(console.error("bounds is missing!"),v(i))}return c(o,[{key:"setBounds",value:function(t){this.bounds=t,this.draw()}},{key:"draw",value:function(){var t=this.bounds[1][0]-this.bounds[0][0],e=this.bounds[1][1]-this.bounds[0][1];this.coords={left:this.bounds[0][0]+t/2,top:this.bounds[0][1]+e/2,width:t,height:e},this.shape?this.shape.set(this.coords):(Object.assign(this.style,this.coords),this.shape=new zt(this.style))}}]),o}(),Tt=function(t){h(u,fabric.Triangle);var l=p(u);function u(t,e){Z(this,u),(e=e||{}).headLength=e.headLength||10,e.stroke=e.stroke||"#207cca";var i=N(t,4),n=i[0],o=i[1],s=i[2],r=i[3],a=s-n,c=r-o,h=Math.atan2(c,a);return h*=180/Math.PI,h+=90,void 0!==e.lastAngle&&(h=e.lastAngle,console.log("Angle: ".concat(h))),l.call(this,{angle:h,fill:e.stroke,top:r,left:s,height:e.headLength,width:e.headLength,originX:"center",originY:"center",selectable:!1})}return u}(),It=function(t){h(o,fabric.Group);var n=p(o);function o(t,e){var i;return Z(this,o),(e=e||{}).strokeWidth=e.strokeWidth||5,e.stroke=e.stroke||"#7db9e8",e.class="arrow",(i=n.call(this,[],Object.assign(e,{evented:!1}))).pointArray=[t,Object.assign({},t)],i.options=e,i.draw(),i}return c(o,[{key:"draw",value:function(){this.head&&this.remove(this.head),this.polyline&&this.remove(this.polyline),this.polyline=new fabric.Polyline(this.pointArray,Object.assign(this.options,{strokeLineJoin:"round",fill:!1})),this.addWithUpdate(this.polyline);var t=this.getLastPoints(),e=new fabric.Point(t[0],t[1]),i=new fabric.Point(t[2],t[3]),n=e.distanceFrom(i);console.log("dis = ".concat(n)),this.head=new Tt(t,Object.assign(this.options,{headLength:2*this.strokeWidth,lastAngle:n<=10?this.lastAngle:void 0})),10<n&&(this.lastAngle=this.head.angle),this.addWithUpdate(this.head)}},{key:"addPoint",value:function(t){this.pointArray.push(t),this.draw()}},{key:"addTempPoint",value:function(t){var e=this.pointArray.length,i=this.pointArray[e-1];i.x=t.x,i.y=t.y,this.draw()}},{key:"getLastPoints",value:function(){var t=this.pointArray.length,e=this.pointArray[t-2],i=this.pointArray[t-1];return[e.x,e.y,i.x,i.y]}},{key:"setColor",value:function(e){this._objects.forEach(function(t){t.setColor(e)})}}]),o}(),Ft="select",Yt="drawing",Bt="arrow",Dt="text",Xt=function(t){h(s,ft);var o=p(s);function s(t,e){var i;Z(this,s),(i=o.call(this,e)).container=t;var n=document.createElement("canvas");return i.container.appendChild(n),n.setAttribute("id","indoorjs-canvas"),n.width=i.width||i.container.clientWidth,n.height=i.height||i.container.clientHeight,i.currentColor=i.currentColor||"black",i.fontFamily=i.fontFamily||"Roboto",i.canvas=new fabric.Canvas(n,{freeDrawingCursor:"none",freeDrawingLineWidth:i.lineWidth}),i.arrows=[],i.setLineWidth(i.lineWidth||10),i.addCursor(),i.addListeners(),i.setModeAsArrow(),i}return c(s,[{key:"setModeAsDrawing",value:function(){this.mode=Yt,this.canvas.isDrawingMode=!0,this.canvas.selection=!1,this.onModeChanged()}},{key:"isDrawingMode",value:function(){return this.mode===Yt}},{key:"setModeAsSelect",value:function(){this.mode=Ft,this.canvas.isDrawingMode=!1,this.canvas.selection=!0,this.onModeChanged()}},{key:"isSelectMode",value:function(){return this.mode===Ft}},{key:"setModeAsArrow",value:function(){this.mode=Bt,this.canvas.isDrawingMode=!1,this.canvas.selection=!1,this.onModeChanged()}},{key:"isArrowMode",value:function(){return this.mode===Bt}},{key:"setModeAsText",value:function(){this.mode=Dt,this.canvas.isDrawingMode=!1,this.canvas.selection=!1,this.onModeChanged()}},{key:"isTextMode",value:function(){return this.mode===Dt}},{key:"onModeChanged",value:function(){var e=this;this.updateCursor(),this.emit("mode-changed",this.mode),this.canvas._objects.forEach(function(t){t.evented=e.isSelectMode()})}},{key:"addListeners",value:function(){var n=this,o=this.canvas;o.on("mouse:move",function(t){var e=o.getPointer(t.e);n.mousecursor&&n.mousecursor.set({top:e.y,left:e.x}).setCoords().canvas.renderAll(),n.isTextMode()?console.log("text"):n.isArrowMode()&&(n.activeArrow&&n.activeArrow.addTempPoint(e),n.canvas.requestRenderAll())}),o.on("mouse:out",function(){n.mousecursor&&(n.mousecursor.set({left:-1e3,top:-1e3}).setCoords(),n.cursor.renderAll())}),o.on("mouse:up",function(t){o.mouseDown&&o.fire("mouse:click",t),o.mouseDown=!1}),o.on("mouse:move",function(t){o.mouseDown=!1}),o.on("mouse:down",function(t){o.mouseDown=!0}),o.on("mouse:click",function(t){console.log("mouse click",t);var e=o.getPointer(t.e);if(!t.target)if(n.isTextMode()){var i=new fabric.IText("Text",{left:e.x,top:e.y,width:100,fontSize:20,fontFamily:n.fontFamily,lockUniScaling:!0,fill:n.currentColor,stroke:n.currentColor});o.add(i).setActiveObject(i).renderAll(),n.setModeAsSelect()}else n.isArrowMode()&&(console.log("arrow mode"),n.activeArrow?n.activeArrow.addPoint(e):(n.activeArrow=new It(e,{stroke:n.currentColor,strokeWidth:n.lineWidth}),n.canvas.add(n.activeArrow)),n.canvas.requestRenderAll())}),o.on("mouse:dblclick",function(t){console.log("mouse:dbclick"),n.isArrowMode()&&n.activeArrow&&(n.arrows.push(n.activeArrow),n.activeArrow=null)}),o.on("selection:created",function(t){n.emit("selected")}),o.on("selection:cleared",function(t){n.emit("unselected")})}},{key:"removeSelected",value:function(){var e=this;this.canvas.remove(this.canvas.getActiveObject()),this.canvas.getActiveObjects().forEach(function(t){e.canvas.remove(t)}),this.canvas.discardActiveObject().renderAll()}},{key:"updateCursor",value:function(){if(this.cursor){var t=this.canvas;this.mousecursor&&(this.cursor.remove(this.mousecursor),this.mousecursor=null);var e=null;e=this.isDrawingMode()?new fabric.Circle({left:-1e3,top:-1e3,radius:t.freeDrawingBrush.width/2,fill:"rgba(255,0,0,".concat(.3,")"),stroke:"black",originX:"center",originY:"center"}):this.isTextMode()?new fabric.Path("M0,-10 V10",{left:-1e3,top:-1e3,radius:t.freeDrawingBrush.width/2,fill:"rgba(255,0,0,".concat(.3,")"),stroke:"rgba(0,0,0,".concat(.3,")"),originX:"center",originY:"center",scaleX:1,scaleY:1}):new fabric.Path("M0,-10 V10 M-10,0 H10",{left:-1e3,top:-1e3,radius:t.freeDrawingBrush.width/2,fill:"rgba(255,0,0,".concat(.3,")"),stroke:"rgba(0,0,0,".concat(.3,")"),originX:"center",originY:"center"}),this.isSelectMode()?(e=null,this.canvas.defaultCursor="default"):this.canvas.defaultCursor="none",e&&this.cursor.add(e),this.mousecursor=e}}},{key:"addCursor",value:function(){var t=this.canvas,e=document.createElement("canvas");this.canvas.wrapperEl.appendChild(e),e.setAttribute("id","indoorjs-cursor-canvas"),e.style.position="absolute",e.style.top="0",e.style.pointerEvents="none",e.width=this.width||this.container.clientWidth,e.height=this.height||this.container.clientHeight,this.cursorCanvas=e,t.defaultCursor="none",this.cursor=new fabric.StaticCanvas(e),this.updateCursor()}},{key:"setColor",value:function(t){this.currentColor=t,this.canvas.freeDrawingBrush.color=t;var e=this.canvas.getActiveObject();e&&(e.set("stroke",t),e.set("fill",t),this.canvas.requestRenderAll()),this.mousecursor&&this.mousecursor.set({left:100,top:100,fill:t}).setCoords().canvas.renderAll()}},{key:"setLineWidth",value:function(t){this.lineWidth=t,this.canvas.freeDrawingBrush.width=t,this.mousecursor&&this.mousecursor.set({left:100,top:100,radius:t/2}).setCoords().canvas.renderAll()}},{key:"setFontFamily",value:function(t){this.fontFamily=t;var e=this.canvas.getActiveObject();e&&"i-text"===e.type&&(e.set("fontFamily",t),this.canvas.requestRenderAll())}},{key:"clear",value:function(){this.arrows=[],this.canvas.clear()}}]),s}();console.log("fabricJS ",e.version||window.fabric.version),console.log("IndoorJS ",i),t.Canvas=Xt,t.Circle=Wt,t.Connector=Mt,t.Floor=jt,t.Group=Ot,t.ICON=x,t.Icon=Pt,t.Layer=Ct,t.Line=Et,t.MAP=w,t.MARKER=k,t.Map=At,t.Marker=Lt,t.MarkerGroup=St,t.Modes=b,t.Point=y,t.Polyline=Rt,t.Rect=zt,t.canvas=function(t,e){return new Xt(t,e)},t.circle=function(t){return new Wt(t)},t.connector=function(t,e,i){return new Mt(t,e,i)},t.floorplan=function(t){return new jt(t)},t.group=function(t,e){return new Ot(t,e)},t.icon=function(t){return new Pt(t)},t.layer=function(t){return new Ct(t)},t.line=function(t,e){return new Et(t,e)},t.map=function(t,e){return new At(t,e)},t.marker=function(t,e){return new Lt(t,e)},t.markerGroup=function(t,e){return new St(t,e)},t.point=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return o(y,e)},t.polyline=function(t,e){return new Rt(t,e)},t.rect=function(t,e){return new zt(t,e)},t.version=i,Object.defineProperty(t,"__esModule",{value:!0});var Ut=window.I;t.noConflict=function(){return window.I=Ut,this},window.I=t});